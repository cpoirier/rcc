#!/usr/bin/env ruby
#================================================================================================================================
#
# Ruby Compiler Compiler (rcc)
#
# Copyright 2007 Chris Poirier (cpoirier@gmail.com)
# Licensed under the Academic Free License version 2.1
#
#================================================================================================================================

   $LOAD_PATH << File.expand_path( "#{File.dirname($0)}/../" )
      
   require "rcc/environment.rb"
   require "rcc/model/grammar.rb"
   require "rcc/code_generation/ruby/generator.rb"

   if ARGV.empty? then
      puts "USAGE: #{File.basename($0)} <grammar file>"
      exit 10
   end
   
   
   grammar = RCC::Model::Grammar.load_from_file( File.basename(ARGV[0]), ARGV[0] )
   grammar.display( STDOUT )
   
   puts()
   puts()
   puts()
   puts()
   puts()
   puts()
   
   parser_plan = grammar.compile_plan()
   # parser_plan.display( STDOUT, "", true, ARGV[1].nil? ? :reduce_determinants : ARGV[1].intern )
   # 
   # puts()
   # puts()
   # puts()
   # puts()
   # puts()
   # puts()
   
   $show_statistics = true
   parser_plan.compile_actions( true )
   
   generator = RCC::CodeGeneration::Ruby::Generator.new({:module_contexts => ["Rethink", "CommandLanguage"]})
   generator.generate( parser_plan )
   
   
   